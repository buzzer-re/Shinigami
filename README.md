# Shinigami
[![Build](https://github.com/buzzer-re/Shinigami/actions/workflows/ci.yml/badge.svg)](https://github.com/buzzer-re/Shinigami/actions/workflows/ci.yml)
[![Release](https://github.com/buzzer-re/Shinigami/actions/workflows/cd.yml/badge.svg)](https://github.com/buzzer-re/Shinigami/actions/workflows/cd.yml)

<figure>
<img src="assets/mascot/shinigami.png" alt="image description" width="30%" height="30%" style="border-radius: 50%;"/>
</figure>


Shinigami is a experimental tool to detect and dump malware implants that are injected via process hollowing technique. It works by hooking common functions like CreateProcessInternal, WriteProcessMemory, and ResumeThread. 

It creates the target executable in a suspended state and injects a DLL library called "Ichigo," which will hook every needed function to detect and dump the implant. The library automatically kills the process once the hollow is extracted.

***The current version only supports Process Hollowing, but I have plans to detect other kinds of unpacking mechanisms for a more general approach.***

## Current detection methods

- ResumeThread
  - By hooking ResumeThread it will hunt inside all the previous allocated memory via `VirtualAllocEx` the DOS header signature, if it found them the remote PE file will be extracted, fixed and dumped in disk with the format ***<executable>_dumped.bin***
- WriteProcessMemory
  - By hooking WriteProcessMemory it will detect if the executable is trying to write a PE file in the remote process, if so, it will hunt using the `lpBuffer` pointer and extract any PE files found in the executable itself (not the injected), this PE file saved as ***<executable>_before_written.bin***
  
Remember that the ResumeThread function's sections are fixed and realigned and will be greater than the real one. The WriteProcessMemory will have the exactly PE file.

## Usage

Shinigami is easy to use. Simply run `shinigami.exe` with the executable you want to analyze as the first argument, followed by any arguments you want to pass to it.

Example usage:

> shinigami.exe sample.exe

The detected implant will be dumped following the format described at Detection methods section

## Expanding 

It would be amazing if you help this project, so if you want here is the dependencies and steps


- Install Visual Studio >= 2019 with the C++ workload.
- Install [Zydis](https://github.com/zyantific/zydis), a fast and lightweight x86/x86-64 disassembler, I recommend use [vcpkg](https://github.com/zyantific/zydis#building-zydis---using-vcpkg) method
- Open the Shinigami.sln solution file in Visual Studio and build/code the project.

Contributions are welcome! Please open an issue or pull request for any changes you would like to make.

## Conclusion

This cool mascot image was inspired on Bleach and generated by [Dall-E](https://openai.com/product/dall-e-2) of OpenAI.

